<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Copilot Spaces レビュー観点管理</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>GitHub Copilot Spaces レビュー観点管理</h1>
            <p class="header-subtitle">コードレビューの品質向上のための観点管理システム</p>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <button class="btn btn--secondary nav-btn active" data-section="main">メイン</button>
            <button class="btn btn--secondary nav-btn" data-section="settings">設定</button>
            <button class="btn btn--secondary nav-btn" data-section="mcp-guide">MCP連携ガイド</button>
            <button class="btn btn--secondary nav-btn" data-section="system-overview">システム構成</button>
        </nav>

        <!-- Main Section -->
        <section id="main-section" class="section active">
            <div class="section-header">
                <h2>レビュー観点管理</h2>
                <button class="btn btn--primary" id="add-review-btn">新しい観点を追加</button>
            </div>

            <!-- Status Display -->
            <div id="status-display" class="status-container hidden"></div>
            <!-- メイン画面のセクションヘッダー下に追加 -->
            <div class="sync-status-container">
                <div class="sync-status">
                    <span id="sync-status">同期ステータス: 未設定</span>
                    <button class="btn btn--outline btn--small" id="manual-sync-btn" onclick="handleManualSync()">
                        手動同期
                    </button>
                </div>
            </div>


            <!-- Add Review Item Form -->
            <div id="add-review-form" class="card hidden">
                <div class="card__header">
                    <h3>新しいレビュー観点を追加</h3>
                </div>
                <div class="card__body">
                    <form id="review-form">
                        <div class="form-group">
                            <label class="form-label" for="category">カテゴリ</label>
                            <select class="form-control" id="category" required>
                                <option value="">カテゴリを選択してください</option>
                                <option value="セキュリティ">セキュリティ</option>
                                <option value="パフォーマンス">パフォーマンス</option>
                                <option value="保守性">保守性</option>
                                <option value="組込み特有">組込み特有</option>
                                <option value="コード品質">コード品質</option>
                                <option value="テスト">テスト</option>
                                <option value="ドキュメント">ドキュメント</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="content">詳細内容</label>
                            <textarea class="form-control" id="content" rows="3" placeholder="レビュー観点の詳細を入力してください" required></textarea>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn--primary">追加</button>
                            <button type="button" class="btn btn--outline" id="cancel-add-btn">キャンセル</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Existing Review Items -->
            <div id="review-items-container">
                <!-- Review items will be populated here -->
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings-section" class="section">
            <h2>設定</h2>
            <div class="card">
                <div class="card__header">
                    <h3>GitHub 認証設定</h3>
                </div>
                <div class="card__body">
                    <form id="settings-form">
                        <div class="form-group">
                            <label class="form-label" for="github-token">Personal Access Token</label>
                            <input type="password" class="form-control" id="github-token" placeholder="ghp_xxxxxxxxxxxxxxxx">
                            <small class="form-help">リポジトリへの読み書き権限が必要です</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="repo-owner">リポジトリ所有者</label>
                            <input type="text" class="form-control" id="repo-owner" placeholder="username または organization">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="repo-name">リポジトリ名</label>
                            <input type="text" class="form-control" id="repo-name" placeholder="repository-name">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="file-path">ファイルパス</label>
                            <input type="text" class="form-control" id="file-path" value=".github/review-checklist.md">
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn--primary">設定を保存</button>
                            <button type="button" class="btn btn--outline" id="test-connection-btn">接続テスト</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- MCP Guide Section -->
        <section id="mcp-guide-section" class="section">
            <h2>MCP連携ガイド</h2>
            
            <div class="card">
                <div class="card__header">
                    <h3>VSCode設定手順</h3>
                </div>
                <div class="card__body">
                    <ol class="setup-steps">
                        <li>GitHub Copilot Spacesを有効化</li>
                        <li>以下の設定をVSCodeの設定ファイルに追加</li>
                        <li>VSCodeを再起動</li>
                        <li>Copilot Spacesでリポジトリに接続</li>
                    </ol>
                </div>
            </div>

            <div class="card">
                <div class="card__header">
                    <h3>MCP Server設定例</h3>
                </div>
                <div class="card__body">
                    <pre><code>{
  "mcpServers": {
    "review-checklist-server": {
      "command": "node",
      "args": ["./mcp-server/index.js"],
      "env": {
        "GITHUB_TOKEN": "あなたのトークン"
      }
    }
  }
}</code></pre>
                </div>
            </div>

            <div class="card">
                <div class="card__header">
                    <h3>連携テスト</h3>
                </div>
                <div class="card__body">
                    <p>設定完了後、以下のコマンドでテストできます：</p>
                    <pre><code>copilot chat --message "レビューチェックリストを表示して"</code></pre>
                    <button class="btn btn--outline" id="test-mcp-btn">MCP接続テスト</button>
                </div>
            </div>
        </section>

        <!-- System Overview Section -->
        <section id="system-overview-section" class="section">
            <h2>システム構成</h2>
            
            <div class="card">
                <div class="card__header">
                    <h3>全体フロー</h3>
                </div>
                <div class="card__body">
                    <div class="system-flow">
                        <div class="flow-item">
                            <div class="flow-step">1</div>
                            <div class="flow-content">
                                <h4>レビュー観点入力</h4>
                                <p>Webアプリでレビュー観点を入力・管理</p>
                            </div>
                        </div>
                        <div class="flow-arrow">↓</div>
                        <div class="flow-item">
                            <div class="flow-step">2</div>
                            <div class="flow-content">
                                <h4>GitHub API連携</h4>
                                <p>リポジトリのMarkdownファイルを更新</p>
                            </div>
                        </div>
                        <div class="flow-arrow">↓</div>
                        <div class="flow-item">
                            <div class="flow-step">3</div>
                            <div class="flow-content">
                                <h4>MCP Server</h4>
                                <p>ファイル変更を検知し、Copilot Spacesに反映</p>
                            </div>
                        </div>
                        <div class="flow-arrow">↓</div>
                        <div class="flow-item">
                            <div class="flow-step">4</div>
                            <div class="flow-content">
                                <h4>Copilot Spaces</h4>
                                <p>レビュー観点を基にコードレビュー支援</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card__header">
                    <h3>コンポーネント説明</h3>
                </div>
                <div class="card__body">
                    <div class="component-grid">
                        <div class="component-item">
                            <h4>Webアプリケーション</h4>
                            <p>レビュー観点の管理UI。GitHub APIを通じてリポジトリのファイルを更新。</p>
                        </div>
                        <div class="component-item">
                            <h4>GitHub Repository</h4>
                            <p>レビューチェックリストを格納するMarkdownファイル。</p>
                        </div>
                        <div class="component-item">
                            <h4>MCP Server</h4>
                            <p>Model Context Protocolを実装し、ファイル変更をCopilot Spacesに通知。</p>
                        </div>
                        <div class="component-item">
                            <h4>Copilot Spaces</h4>
                            <p>MCPサーバーから情報を取得し、コードレビューを支援。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Loading Modal -->
        <div id="loading-modal" class="modal hidden">
            <div class="modal-content">
                <div class="loading-spinner"></div>
                <p>処理中...</p>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <!-- Loading Modal -->
<div id="loading-modal" class="loading-modal hidden">
    <div class="loading-modal__backdrop"></div>
    <div class="loading-modal__content">
        <div class="loading-spinner"></div>
        <p class="loading__text">読み込み中...</p>
    </div>
</div>

</body>
</html>
